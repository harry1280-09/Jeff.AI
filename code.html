<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Playground - Ferris AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <img src="logo.svg" alt="Ferris AI Logo" style="height: 80px;">
        <h1>Code Playground</h1>
    </header>
    <nav>
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="games.html">Games</a>
        <a href="chat.html" id="chatLink">AI Chat</a>
        <a href="settings.html" id="settingsLink">Settings</a>
        <a href="code.html">Code Playground</a>
        <button id="logoutBtn">Logout</button>
    </nav>
    <main id="code">
        <div class="top-bar">
            <button id="newFileBtn">New File</button>
            <button id="newCodeSpaceBtn">New Code Space</button>
            <button id="saveBtn">Save</button>
        </div>
        <div id="fileTabs">
            <!-- Tabs for multiple files will be dynamically added here -->
        </div>
        <div id="fileEditors">
            <!-- Code editors for multiple files will be dynamically added here -->
        </div>
        <div id="previewContainer">
            <h3>Live Preview:</h3>
            <div id="outputContainer">
                <pre id="outputText" class="outputBox"></pre>
                <div id="outputImage" class="outputBox"></div>
                <iframe id="outputIframe" class="outputBox"></iframe>
            </div>
        </div>
    </main>
    <footer>
        <p>&copy; 2025 Ferris AI</p>
    </footer>
    <script>
        const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
        if (!isAuthenticated) {
            document.getElementById('chatLink').style.display = 'none';
            document.getElementById('settingsLink').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('isAdmin');
            alert('You have been logged out.');
            window.location.href = 'login.html'; // Redirect to login page
        });

        const fileTabs = document.getElementById('fileTabs');
        const fileEditors = document.getElementById('fileEditors');
        const files = {};

        document.getElementById('newFileBtn').addEventListener('click', () => {
            const fileName = prompt('Enter file name (e.g., main.py)');
            const fileType = prompt('Enter file type (e.g., python, html, javascript, etc.)');
            if (fileName && fileType && !files[fileName]) {
                addFileTab(fileName, fileType);
                files[fileName] = { type: fileType, content: '' };
            }
        });

        document.getElementById('newCodeSpaceBtn').addEventListener('click', () => {
            if (confirm('Are you sure you want to create a new code space? This will clear all current files.')) {
                while (fileTabs.firstChild) fileTabs.removeChild(fileTabs.firstChild);
                while (fileEditors.firstChild) fileEditors.removeChild(fileEditors.firstChild);
                Object.keys(files).forEach(key => delete files[key]);
            }
        });

        document.getElementById('saveBtn').addEventListener('click', () => {
            const codeSpace = JSON.stringify(files);
            const blob = new Blob([codeSpace], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'code_space.json';
            a.click();
            URL.revokeObjectURL(url);
        });

        function addFileTab(fileName, fileType) {
            const tab = document.createElement('button');
            tab.textContent = fileName;
            tab.classList.add('fileTab');
            tab.addEventListener('click', () => openFile(fileName));
            fileTabs.appendChild(tab);

            const editor = document.createElement('textarea');
            editor.id = `editor-${fileName}`;
            editor.classList.add('codeEditor');
            editor.addEventListener('input', (e) => {
                files[fileName].content = e.target.value;
                updatePreview();
            });
            fileEditors.appendChild(editor);
            openFile(fileName);
        }

        function openFile(fileName) {
            const editors = document.querySelectorAll('.codeEditor');
            editors.forEach(editor => editor.style.display = 'none');
            document.getElementById(`editor-${fileName}`).style.display = 'block';
        }

        function updatePreview() {
            const fileEntries = Object.entries(files);
            const language = fileEntries[0]?.[1]?.type;

            if (language === 'html') {
                const htmlContent = fileEntries.map(([fileName, file]) => {
                    return `<script type="text/plain" data-filename="${fileName}">${file.content}</script>`;
                }).join('\n');
                const iframe = document.getElementById('outputIframe');
                iframe.srcdoc = htmlContent;
                showOutput('html');
                return;
            }

            document.getElementById('outputText').textContent = '';
            fileEntries.forEach(([fileName, file]) => {
                document.getElementById('outputText').textContent += `# ${fileName}\n${file.content}\n\n`;
            });
            showOutput('text');
        }

        function showOutput(type) {
            document.getElementById('outputText').style.display = type === 'text' ? 'block' : 'none';
            document.getElementById('outputImage').style.display = type === 'image' ? 'block' : 'none';
            document.getElementById('outputIframe').style.display = type === 'html' ? 'block' : 'none';
        }
    </script>
</body>
</html>
